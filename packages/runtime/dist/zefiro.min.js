function t(t,n){const{class:o,style:s,...i}=n;delete i.key,o&&function(t,e){t.className="","string"==typeof e&&(t.className=e);Array.isArray(e)&&t.classList.add(...e)}(t,o),s&&Object.entries(s).forEach((([e,n])=>{r(t,e,n)}));for(const[n,r]of Object.entries(i))e(t,n,r)}function e(t,e,r){null==r?n(t,e):e.startsWith("data-")?t.setAttribute(e,r):t[e]=r}function n(t,e){try{t[e]=null}catch{console.warn(`Failed to set "${e}" to null on ${t.tagName}`)}t.removeAttribute(e)}function r(t,e,n){t.style[e]=n}function o(t,e){t.style[e]=null}function s(t,e,n,r=null){function o(){r?e.apply(r,arguments):e(...arguments)}return n.addEventListener(t,o),o}function i(t){return t.filter((t=>null!=t))}const c="add",a="remove",l="move",u="noop";class h{#t=[];#e=[];#n;constructor(t,e){this.#t=[...t],this.#e=t.map(((t,e)=>e)),this.#n=e}get length(){return this.#t.length}originalIndexAt(t){return this.#e[t]}findIndexFrom(t,e){for(let n=e;n<this.length;n++)if(this.#n(t,this.#t[n]))return n;return-1}isRemoval(t,e){if(t>=this.length)return!1;const n=this.#t[t];return-1===e.findIndex((t=>this.#n(n,t)))}removeItem(t){const e={op:a,index:t,item:this.#t[t]};return this.#t.splice(t,1),this.#e.splice(t,1),e}isNoop(t,e){if(t>=this.length)return!1;const n=this.#t[t],r=e[t];return this.#n(n,r)}noopItem(t){return{op:u,index:t,originalIndex:this.originalIndexAt(t),item:this.#t[t]}}isAddition(t,e){return-1===this.findIndexFrom(t,e)}addItem(t,e){const n={op:c,index:e,item:t};return this.#t.splice(e,0,t),this.#e.splice(e,0,-1),n}moveItem(t,e){const n=this.findIndexFrom(t,e),r={op:l,originalIndex:this.originalIndexAt(n),from:n,index:e,item:this.#t[n]},[o]=this.#t.splice(n,1);this.#t.splice(e,0,o);const[s]=this.#e.splice(n,1);return this.#e.splice(e,0,s),r}removeItemsAfter(t){const e=[];for(;this.length>t;)e.push(this.removeItem(t));return e}}function d(t,e="Assertion failed"){if(!t)throw new Error(e)}const f={TEXT:"text",ELEMENT:"element",FRAGMENT:"fragment",COMPONENT:"component"};function p(t,e={},n=[]){return{tag:t,props:e,type:"string"==typeof t?f.ELEMENT:f.COMPONENT,children:E(i(n))}}function m(t){return{type:f.TEXT,value:t}}function y(t){return d(Array.isArray(t),"hFragment expects an array of vNodes"),{type:f.FRAGMENT,children:E(i(t))}}function E(t){return t.map((t=>"string"==typeof t?m(t):t))}function v(t){if(null==t.children)return[];const e=[];for(const n of t.children)n.type===f.FRAGMENT?e.push(...v(n)):e.push(n);return e}function g(t){const{on:e={},...n}=t.props;return delete n.key,{props:n,events:e}}let b=!1;const O=[];function M(){for(;O.length;){const t=O.shift(),e=t();Promise.resolve(e).then((()=>{}),(t=>{console.error(`[scheduler]: ${t}`)})),t()}b=!1}function N(){b||(b=!0,queueMicrotask(M))}function w(t){O.push(t),N()}function T(){return N(),new Promise((t=>setTimeout(t)))}function I(e,n,r,o=null){switch(e.type){case f.TEXT:!function(t,e,n){const{value:r}=t,o=document.createTextNode(r);t.el=o,x(o,e,n)}(e,n,r);break;case f.ELEMENT:!function(e,n,r,o){const{tag:i,children:c}=e,a=document.createElement(i);(function(e,n,r){const{props:o,events:i}=g(n);n.listeners=function(t={},e,n=null){const r={};return Object.entries(t).forEach((([t,o])=>{const i=s(t,o,e,n);r[t]=i})),r}(i,e,r),t(e,o)})(a,e,o),e.el=a,c.forEach((t=>I(t,a,null,o))),x(a,n,r)}(e,n,r,o);break;case f.FRAGMENT:!function(t,e,n,r){const{children:o}=t;t.el=e;for(const t of o)if(I(t,e,n,r),null!=n)switch(t.type){case f.FRAGMENT:n+=t.children.length;break;case f.COMPONENT:n+=t.component.elements.length;break;default:n++}}(e,n,r,o);break;case f.COMPONENT:!function(t,e,n,r){const o=t.tag,{props:s,events:i}=g(t),c=new o(s,i,r);c.mount(e,n),t.component=c,t.el=c.firstElement}(e,n,r,o),w((()=>e.component.onMounted())),e.component.onMounted();break;default:throw new Error(`Can't mount DOM of type: ${e.type}`)}}function x(t,e,n){if(null==n)return void e.append(t);if(n<0)throw new Error(`Index must be a positive integer, got ${n}`);const r=e.childNodes;n>=r.length?e.append(t):e.insertBefore(t,r[n])}function A(t){const{type:e}=t;switch(e){case f.TEXT:!function(t){const{el:e}=t;d(e instanceof Text),e.remove()}(t);break;case f.ELEMENT:!function(t){const{el:e,children:n,listeners:r}=t;d(e instanceof HTMLElement),e.remove(),n.forEach(A),r&&(!function(t={},e){Object.entries(t).forEach((([t,n])=>{e.removeEventListener(t,n)}))}(r,e),delete t.listeners)}(t);break;case f.FRAGMENT:!function(t){const{children:e}=t;e.forEach(A)}(t);break;case f.COMPONENT:t.component.unmount(),w((()=>t.component.onUnmounted()));break;default:throw new Error(`Can't destroy DOM of type: ${e}`)}delete t.el}function k(t,e={}){let n=null,r=!1,o=null;return{mount(s){if(r)throw new Error("The application is already mounted");n=s,o=p(t,e),I(o,n),r=!0},unmount(){if(!r)throw new Error("The application is not mounted");A(o),n=null,r=!1,o=null}}}function C(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var F,P;var j=(P||(P=1,F=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var r,o,s;if(Array.isArray(e)){if((r=e.length)!=n.length)return!1;for(o=r;0!=o--;)if(!t(e[o],n[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((r=(s=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(o=r;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,s[o]))return!1;for(o=r;0!=o--;){var i=s[o];if(!t(e[i],n[i]))return!1}return!0}return e!=e&&n!=n}),F),H=C(j);class L{#r=new Map;#o=[];subscribe(t,e){this.#r.has(t)||this.#r.set(t,[]);const n=this.#r.get(t);return n.includes(e)?()=>{}:(n.push(e),()=>{const t=n.indexOf(e);n.splice(t,1)})}afterEveryCommand(t){return this.#o.push(t),()=>{const e=this.#o.indexOf(t);this.#o.splice(e,1)}}dispatch(t,e){this.#r.has(t)?this.#r.get(t).forEach((t=>t(e))):console.warn(`No handlers for command: ${t}`),this.#o.forEach((t=>t()))}}function R(t,e){if(t.type!==e.type)return!1;if(t.type===f.ELEMENT){const{tag:n,props:{key:r}}=t,{tag:o,props:{key:s}}=e;return n===o&&r===s}if(t.type===f.COMPONENT){const{tag:n,props:{key:r}}=t,{tag:o,props:{key:s}}=e;return n===o&&r===s}return!0}function G(t,e){const n=Object.keys(t),r=Object.keys(e);return{added:r.filter((e=>!(e in t))),removed:n.filter((t=>!(t in e))),updated:r.filter((n=>n in t&&t[n]!==e[n]))}}function $(t){return function(t){return""!==t}(t.trim())}function q(t,i,d,p=null){if(!R(t,i)){const e=function(t,e){const n=Array.from(t.childNodes).indexOf(e);if(n<0)return null;return n}(d,t.el);return A(t),I(i,d,e,p),i}switch(i.el=t.el,i.type){case f.TEXT:return function(t,e){const n=t.el,{value:r}=t,{value:o}=e;r!==o&&(n.nodeValue=o)}(t,i),i;case f.ELEMENT:!function(t,i,c){const a=t.el,{class:l,style:u,on:h,...d}=t.props,{class:f,style:p,on:m,...y}=i.props,{listeners:E}=t;(function(t,r,o){const{added:s,removed:i,updated:c}=G(r,o);for(const e of i)n(t,e);for(const n of s.concat(c))e(t,n,o[n])})(a,d,y),function(t,e,n){const r=S(e),o=S(n),{added:s,removed:i}=(c=r,a=o,{added:a.filter((t=>!c.includes(t))),removed:c.filter((t=>!a.includes(t)))});var c,a;i.length>0&&t.classList.remove(...i);s.length>0&&t.classList.add(...s)}(a,l,f),function(t,e={},n={}){const{added:s,removed:i,updated:c}=G(e,n);for(const e of i)o(t,e);for(const e of s.concat(c))r(t,e,n[e])}(a,u,p),i.listeners=function(t,e={},n={},r={},o){const{removed:i,added:c,updated:a}=G(n,r);for(const n of i.concat(a))t.removeEventListener(n,e[n]);const l={};for(const e of c.concat(a)){const n=s(e,r[e],t,o);l[e]=n}return l}(a,E,h,m,c)}(t,i,p);break;case f.COMPONENT:!function(t,e){const{component:n}=t,{props:r}=g(e);n.updateProps(r),e.component=n,e.el=n.firstElement}(t,i)}return function(t,e,n){const r=v(t),o=v(e),s=t.el,i=function(t,e,n=(t,e)=>t===e){const r=[],o=new h(t,n);for(let t=0;t<e.length;t++){if(o.isRemoval(t,e)){r.push(o.removeItem(t)),t--;continue}if(o.isNoop(t,e)){r.push(o.noopItem(t));continue}const n=e[t];o.isAddition(n,t)?r.push(o.addItem(n,t)):r.push(o.moveItem(n,t))}return r.push(...o.removeItemsAfter(e.length)),r}(r,o,R);for(const t of i){const{originalIndex:e,index:i,item:h}=t,d=n?.offset??0;switch(t.op){case c:I(h,s,i+d,n);break;case a:A(h);break;case l:{const t=r[e],c=o[i],a=t.el,l=s.childNodes[i+d];s.insertBefore(a,l),q(t,c,s,n);break}case u:q(r[e],o[i],s,n)}}}(t,i,p),i}function S(t=""){return Array.isArray(t)?t.filter($):t.split(/(\s+)/).filter($)}const X=()=>{};function U({render:t,state:e,onMounted:n=X,onUnMounted:r=X,...o}){class s{#s=!1;#i=null;#c=null;#a=null;#l=null;#u=new L;#h=[];constructor(t={},n={},r=null){this.props=t,this.state=e?e(t):{},this.#a=n,this.#l=r}onMounted(){return Promise.resolve(n.call(this))}onUnMounted(){return Promise.resolve(r.call(this))}get parentComponent(){return this.#l}get vdom(){return this.#i}get elements(){return null==this.#i?[]:this.#i.type===f.FRAGMENT?v(this.#i).flatMap((t=>t.type===f.COMPONENT?t.component.elements:[t.el])):[this.#i.el]}get firstElement(){return this.elements[0]}get offset(){return this.#i.type===f.FRAGMENT?Array.from(this.#c.children).indexOf(this.firstElement):0}updateProps(t){const e={...this.props,...t};H(this.props,e)||(this.props=e,this.#d())}updateState(t){this.state={...this.state,...t},this.#d()}render(){return t.call(this)}mount(t,e=null){if(this.#s)throw new Error("Component is already mounted");this.#i=this.render(),I(this.#i,t,e,this),this.#f(),this.#s=!0,this.#c=t}#f(){this.#h=Object.entries(this.#a).map((([t,e])=>this.#p(t,e)))}#p(t,e){return this.#u.subscribe(t,(t=>{this.#l?e.call(this.#l,t):e(t)}))}unmount(){if(!this.#s)throw new Error("Component is not mounted");A(this.#i),this.#h.forEach((t=>t())),this.#i=null,this.#s=!1,this.#c=null,this.#h=[]}emit(t,e){this.#u.dispatch(t,e)}#d(){if(!this.#s)throw new Error("Component is not mounted");const t=this.render();this.#i=q(this.#i,t,this.#c,this)}}for(const t in o){if(i=s,c=t,Object.prototype.hasOwnProperty.call(i,c))throw new Error(`Method "${t}()" already exists in the component. Can't override existing methods.`);s.prototype[t]=o[t]}var i,c;return s}export{f as DOM_TYPES,k as createApp,U as defineComponent,p as h,y as hFragment,m as hString,T as nextTick};
